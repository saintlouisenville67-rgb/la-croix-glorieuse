<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Breviarium Pro</title>
    <style>
        :root {
            --gold: #d4af37;
            --bg-app: #ffffff;
        }

        body, html {
            margin: 0; padding: 0; height: 100%; width: 100%;
            overflow: hidden; background-color: #000; /* Fond pour la sortie */
        }

        /* Conteneur principal avec animation d'entrée fluide */
        #app-viewport {
            height: 100vh;
            width: 100vw;
            background: var(--bg-app);
            transition: transform 0.6s cubic-bezier(0.16, 1, 0.3, 1), opacity 0.5s ease;
            animation: appIn 0.7s cubic-bezier(0.16, 1, 0.3, 1) forwards;
            display: flex;
            flex-direction: column;
        }

        @keyframes appIn {
            from { opacity: 0; transform: scale(1.05); }
            to { opacity: 1; transform: scale(1); }
        }

        /* Sortie pro */
        .app-exit {
            transform: scale(0.9) translateY(20px) !important;
            opacity: 0 !important;
            pointer-events: none;
        }

        iframe { border: none; width: 100%; height: 100%; flex-grow: 1; }

        /* Bouton Flottant Premium */
        #drag-btn {
            position: fixed;
            top: 30px;
            right: 20px;
            z-index: 9999;
            width: 48px;
            height: 48px;
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: grab;
            box-shadow: 0 8px 24px rgba(0,0,0,0.12);
            border: 1px solid rgba(255,255,255,0.3);
            touch-action: none;
            transition: opacity 0.3s ease, transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        #drag-btn:active { cursor: grabbing; transform: scale(0.9); }
        
        .btn-icon {
            font-size: 28px;
            font-weight: 200;
            color: #1a1a1a;
            pointer-events: none;
            user-select: none;
        }

        /* Indicateur de chargement discret */
        #loader {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 3px;
            background: linear-gradient(90deg, transparent, var(--gold), transparent);
            z-index: 10000;
            animation: loading 2s infinite;
        }

        @keyframes loading {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }
    </style>
</head>
<body>

    <div id="loader"></div>

    <div id="app-viewport">
        <div id="drag-btn">
            <span class="btn-icon">&times;</span>
        </div>
        <iframe src="https://breviariumgregorianum.com/" id="site-frame"></iframe>
    </div>

    <script>
        const btn = document.getElementById('drag-btn');
        const viewport = document.getElementById('app-viewport');
        const loader = document.getElementById('loader');
        
        // --- ANIMATION DE FERMETURE PRO ---
        btn.onclick = (e) => {
            // Empêche le clic si on était en train de draguer
            if (isDragging) return;
            
            viewport.classList.add('app-exit');
            setTimeout(() => {
                window.location.href = 'index.html';
            }, 500); // Délai pour laisser l'animation se finir
        };

        // --- SYSTÈME DE DRAG & MAGNETISME ---
        let isDragging = false;
        let startX, startY;

        btn.onpointerdown = (e) => {
            isDragging = false;
            startX = e.clientX - btn.offsetLeft;
            startY = e.clientY - btn.offsetTop;
            btn.setPointerCapture(e.pointerId);
            
            btn.onpointermove = (em) => {
                isDragging = true;
                let x = em.clientX - startX;
                let y = em.clientY - startY;
                
                // Limites de l'écran
                x = Math.max(10, Math.min(x, window.innerWidth - 58));
                y = Math.max(10, Math.min(y, window.innerHeight - 58));
                
                btn.style.left = x + 'px';
                btn.style.top = y + 'px';
                btn.style.right = 'auto'; // Désactive le right initial
            };
        };

        btn.onpointerup = (e) => {
            btn.onpointermove = null;
            // Aimantage automatique au bord le plus proche
            if (isDragging) {
                const midX = window.innerWidth / 2;
                const currentX = parseInt(btn.style.left);
                btn.style.transition = "all 0.4s cubic-bezier(0.16, 1, 0.3, 1)";
                
                if (currentX < midX) {
                    btn.style.left = '15px';
                } else {
                    btn.style.left = (window.innerWidth - 60) + 'px';
                }
                
                setTimeout(() => { btn.style.transition = "opacity 0.3s ease"; }, 400);
            }
        };

        // Cache le loader quand l'iframe est chargée
        document.getElementById('site-frame').onload = () => {
            loader.style.display = 'none';
        };
    </script>
</body>
</html>
