<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Bible - La Croix Glorieuse</title>
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Crimson+Pro:wght@400;600&display=swap');
        body { background-color: #0f172a; color: #f1f5f9; overflow-x: hidden; -webkit-tap-highlight-color: transparent; }
        .bible-text { font-family: 'Crimson Pro', serif; line-height: 1.8; text-align: justify; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        .book-card, .chapter-card {
            min-width: 100px; height: 50px; display: flex; align-items: center; justify-content: center;
            background: #1e293b; border-radius: 16px; margin-right: 12px; font-size: 0.85rem;
            font-weight: 600; cursor: pointer; border: 1px solid #334155;
            transition: all 0.3s ease; white-space: nowrap; padding: 0 20px; color: #94a3b8;
        }
        .book-card.active, .chapter-card.active {
            background: #e11d48; border-color: #fb7185; color: white; transform: scale(1.05);
            box-shadow: 0 10px 15px -3px rgba(225, 29, 72, 0.4);
        }

        .glass-header { background: rgba(15, 23, 42, 0.9); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); }
        .v-num { color: #e11d48; font-weight: 800; font-size: 0.65em; vertical-align: top; margin-right: 4px; margin-left: 8px; }
        
        #btn-back-to-chapters {
            position: fixed; bottom: 100px; right: 20px; background: #e11d48;
            width: 45px; height: 45px; border-radius: 50%; display: none;
            align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(0,0,0,0.5); z-index: 100;
        }

        /* Style des flèches de navigation chapitre */
        .nav-chap { background: #1e293b; border: 1px solid #334155; padding: 8px 12px; border-radius: 10px; color: #fb7185; font-weight: bold; }
        .nav-chap:disabled { opacity: 0.2; color: #475569; }
    </style>
</head>
<body class="min-h-screen pb-24">

    <header class="sticky top-0 z-50 glass-header p-6 rounded-b-[40px] border-b border-slate-800 shadow-xl">
        <div class="flex justify-between items-center"> 
            <div class="flex items-center gap-4">
                <div>
                    <h1 class="text-xl font-bold bg-gradient-to-r from-white to-slate-400 bg-clip-text text-transparent">La Sainte Bible</h1>
                    <p class="text-[10px] uppercase tracking-[0.2em] text-rose-500 font-black">Crampon 1923</p>
                </div>
                <button onclick="window.location.href='index.html'" class="flex items-center gap-2 bg-white/5 backdrop-blur-lg hover:bg-white/10 text-slate-400 px-3 py-1.5 rounded-full transition-all active:scale-95 border border-white/10">
                    <span class="text-[9px] font-black uppercase tracking-widest">Fermer</span>
                    <svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
            </div>
            <div class="flex bg-slate-800/80 rounded-full p-1 border border-slate-700">
                <button onclick="changeFontSize(-2)" class="w-10 h-8 flex items-center justify-center text-lg font-bold hover:text-rose-400">-</button>
                <button onclick="changeFontSize(2)" class="w-10 h-8 flex items-center justify-center text-lg font-bold hover:text-rose-400">+</button>
            </div>
        </div>
    </header>

    <main class="p-4 mt-4">
        <section class="mb-8">
            <h2 class="text-[11px] font-black text-slate-500 uppercase tracking-widest mb-4 ml-2 flex items-center">
                <span class="w-2 h-2 bg-rose-500 rounded-full mr-2"></span> Ancien Testament
            </h2>
            <div id="at-list" class="flex overflow-x-auto no-scrollbar pb-2 pl-2"></div>
        </section>

        <section class="mb-8">
            <h2 class="text-[11px] font-black text-slate-500 uppercase tracking-widest mb-4 ml-2 flex items-center">
                <span class="w-2 h-2 bg-amber-500 rounded-full mr-2"></span> Nouveau Testament
            </h2>
            <div id="nt-list" class="flex overflow-x-auto no-scrollbar pb-2 pl-2"></div>
        </section>

        <div id="chapter-section" class="hidden mb-10">
            <h2 id="selected-book-title" class="text-[11px] font-black text-rose-500 uppercase tracking-widest mb-4 ml-2"></h2>
            <div id="chapters-list" class="flex overflow-x-auto no-scrollbar pb-4 pl-2"></div>
        </div>

        <div id="bible-content" class="px-4 max-w-2xl mx-auto pb-20">
            <div id="chapter-nav-header" class="hidden flex justify-between items-center mb-6">
                <button id="prev-chap" class="nav-chap" onclick="navChapter(-1)">←</button>
                <div id="chapter-indicator" class="text-slate-500 uppercase text-[10px] tracking-[0.4em] font-bold"></div>
                <button id="next-chap" class="nav-chap" onclick="navChapter(1)">→</button>
            </div>
            
            <div id="bible-text-container" class="bible-text text-slate-200">
                <div class="text-center py-20 opacity-20">Sélectionnez un livre et un chapitre</div>
            </div>
        </div>
    </main>

    <button id="btn-back-to-chapters" onclick="scrollToChapters()">
        <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 text-white" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M5 15l7-7 7 7" />
        </svg>
    </button>

    <script src="js/config.js"></script>
    <script src="js/menu.js"></script>

    <script>
        let currentFontSize = 19;
        let currentBook = "";
        let currentChapter = 1;
        let maxChaptersInBook = 1;

        const booksAT = ["Genèse", "Exode", "Lévitique", "Nombres", "Deutéronome", "Josué", "Juges", "Ruth", "1 Samuel", "2 Samuel", "1 Rois", "2 Rois", "1 Chroniques", "2 Chroniques", "Esdras", "Néhémie", "Tobie", "Judith", "Esther", "1 Machabées", "2 Machabées", "Job", "Psaumes", "Proverbes", "Ecclésiaste", "Cantique des Cantiques", "Sagesse", "Ecclésiastique", "Isaïe", "Jérémie", "Lamentations", "Baruch", "Ezéchiel", "Daniel", "Osée", "Joël", "Amos", "Abdias", "Jonas", "Michée", "Nahum", "Habacuc", "Sophonie", "Aggée", "Zacharie", "Malachie"];
        const booksNT = ["Matthieu", "Marc", "Luc", "Jean", "Actes", "Romains", "1 Corinthiens", "2 Corinthiens", "Galates", "Ephésiens", "Philippiens", "Colossiens", "1 Thessaloniciens", "2 Thessaloniciens", "1 Timothée", "2 Timothée", "Tite", "Philémon", "Hébreux", "Jacques", "1 Pierre", "2 Pierre", "1 Jean", "2 Jean", "3 Jean", "Jude", "Apocalypse"];

        function renderBooks() {
            document.getElementById('at-list').innerHTML = booksAT.map(b => `<div class="book-card" onclick="selectBook(this, '${b.replace(/'/g, "\\'")}')">${b}</div>`).join('');
            document.getElementById('nt-list').innerHTML = booksNT.map(b => `<div class="book-card" onclick="selectBook(this, '${b.replace(/'/g, "\\'")}')">${b}</div>`).join('');
        }

        async function selectBook(element, bookName) {
            currentBook = bookName;
            document.querySelectorAll('.book-card').forEach(el => el.classList.remove('active'));
            element.classList.add('active');
            
            document.getElementById('selected-book-title').innerText = "Chapitres : " + bookName;
            document.getElementById('chapter-section').classList.remove('hidden');
            document.getElementById('bible-text-container').innerHTML = "";
            document.getElementById('chapter-nav-header').classList.add('hidden');
            document.getElementById('btn-back-to-chapters').style.display = "none";

            const { data } = await sb.from('bible_crampon').select('chapitre').eq('livre', bookName).order('chapitre', { ascending: false }).limit(1);

            if (data && data.length > 0) {
                maxChaptersInBook = data[0].chapitre;
                let html = '';
                for(let i=1; i <= maxChaptersInBook; i++) {
                    html += `<div class="chapter-card" id="chap-btn-${i}" onclick="loadChapter(this, '${bookName.replace(/'/g, "\\'")}', ${i})">${i}</div>`;
                }
                document.getElementById('chapters-list').innerHTML = html;
                document.getElementById('chapter-section').scrollIntoView({ behavior: 'smooth', block: 'center' });
            }
        }

        async function loadChapter(btnElement, book, chapter) {
            currentChapter = chapter;
            document.querySelectorAll('.chapter-card').forEach(el => el.classList.remove('active'));
            if(btnElement) btnElement.classList.add('active');
            else document.getElementById(`chap-btn-${chapter}`)?.classList.add('active');

            const container = document.getElementById('bible-text-container');
            container.innerHTML = "<div class='text-center py-10 text-rose-500 animate-pulse'>...</div>";

            const { data } = await sb.from('bible_crampon').select('verset_num, texte').eq('livre', book).eq('chapitre', chapter).order('verset_num', { ascending: true });

            if (data) {
                document.getElementById('chapter-nav-header').classList.remove('hidden');
                document.getElementById('chapter-indicator').innerText = `— Chapitre ${chapter} —`;
                document.getElementById('prev-chap').disabled = (chapter <= 1);
                document.getElementById('next-chap').disabled = (chapter >= maxChaptersInBook);

                let html = `<div style="font-size: ${currentFontSize}px">`;
                html += data.map(v => `<span class="v-num">${v.verset_num}</span>${v.texte}`).join(' ');
                html += `</div>`;
                
                container.innerHTML = html;
                document.getElementById('btn-back-to-chapters').style.display = "flex";
                setTimeout(() => { document.getElementById('chapter-nav-header').scrollIntoView({ behavior: 'smooth', block: 'start' }); }, 100);
            }
        }

        function navChapter(delta) {
            let next = currentChapter + delta;
            if(next >= 1 && next <= maxChaptersInBook) {
                loadChapter(null, currentBook, next);
            }
        }

        function scrollToChapters() {
            document.getElementById('chapter-section').scrollIntoView({ behavior: 'smooth', block: 'center' });
        }

        function changeFontSize(delta) {
            currentFontSize += delta;
            if(currentFontSize < 12) currentFontSize = 12;
            const container = document.querySelector('#bible-text-container > div');
            if(container) container.style.fontSize = currentFontSize + 'px';
        }

        window.onload = renderBooks;
    </script>
</body>
</html>
