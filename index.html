<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>La Croix Glorieuse</title>
    
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="manifest" href="manifest.json">
</head>
<body>

    <header class="gradient-header p-8 rounded-b-[40px] shadow-lg text-white">
        <div class="flex justify-between items-center mb-6">
            <div>
                <h1 class="text-2xl font-800 tracking-tight mb-1">La Croix Glorieuse</h1>
                <p class="text-[10px] font-black uppercase tracking-widest opacity-80">Paroisse Personnelle • Strasbourg</p>
            </div>
            <a href="admin.html" class="opacity-40 hover:opacity-100 transition-opacity p-2" title="Administration">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                </svg>
            </a>
        </div>

        <div id="next-messe" class="bg-white/20 backdrop-blur-md rounded-2xl p-4 border border-white/20">
            <div class="flex items-center gap-2 mb-2">
                <div class="w-2 h-2 rounded-full bg-emerald-400 animate-pulse"></div>
                <span class="text-[9px] font-black uppercase tracking-[0.2em]">Liturgie du jour</span>
            </div>
            <div id="messe-details">
                <p class="text-sm font-bold opacity-60">Chargement...</p>
            </div>
        </div>
    </header>

    <main class="p-6 space-y-8 pb-24">
        
        <section id="verset-container" class="text-center py-4 px-6 bg-white rounded-[30px] shadow-sm border border-slate-100 italic">
            <p class="text-slate-400 text-[10px] font-black uppercase tracking-widest mb-2">La Parole de Vie</p>
            </section>

        <section>
            <div class="flex justify-between items-end mb-4 px-1">
                <div>
                    <h2 class="text-xl font-800 text-slate-800">Annonces</h2>
                    <p class="text-[10px] font-black text-slate-400 uppercase tracking-widest">Vie de la communauté</p>
                </div>
                <div id="badge-annonces" class="hidden bg-red-600 text-white text-[8px] font-black px-2 py-1 rounded-full animate-bounce">NOUVEAU</div>
            </div>
            <div id="annonces-list" class="space-y-4">
                </div>
        </section>

    </main>

    <nav class="fixed bottom-6 left-6 right-6 z-[100]">
        <div class="bg-slate-900/90 backdrop-blur-xl rounded-[30px] p-2 shadow-2xl border border-white/10">
            <div class="flex justify-around items-center">
                <a href="index.html" class="flex flex-col items-center p-3 text-white">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path><polyline points="9 22 9 12 15 12 15 22"></polyline></svg>
                    <span class="text-[8px] font-black uppercase tracking-tighter mt-1">Accueil</span>
                </a>
                <a href="entraide.html" class="flex flex-col items-center p-3 text-slate-500">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>
                    <span class="text-[8px] font-black uppercase tracking-tighter mt-1">Entraide</span>
                </a>
                <a href="priere.html" class="flex flex-col items-center p-3 text-slate-500">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z"></path></svg>
                    <span class="text-[8px] font-black uppercase tracking-tighter mt-1">Prière</span>
                </a>
                <a href="contact.html" class="flex flex-col items-center p-3 text-slate-500">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"></path></svg>
                    <span class="text-[8px] font-black uppercase tracking-tighter mt-1">Contact</span>
                </a>
            </div>
        </div>
    </nav>

    <script src="js/config.js"></script>
    <script>
        async function loadAnnonces() {
            const list = document.getElementById('annonces-list');
            const { data } = await sb.from('annonces')
                .select('*')
                .order('est_importante', { ascending: false })
                .order('created_at', { ascending: false });

            if (data) {
                list.innerHTML = data.map(a => `
                    <div class="card group transition-all active:scale-[0.98] ${a.est_importante ? 'border-l-4 border-red-600' : ''}">
                        ${a.est_importante ? `
                            <div class="flex items-center gap-1.5 mb-2">
                                <span class="w-1.5 h-1.5 rounded-full bg-red-600 animate-pulse"></span>
                                <span class="text-[9px] font-black text-red-600 uppercase tracking-widest">Important</span>
                            </div>
                        ` : ''}
                        <h3 class="text-sm font-900 text-slate-800 mb-2 leading-tight uppercase tracking-tight">${a.titre}</h3>
                        <p class="text-xs text-slate-500 leading-relaxed">${a.contenu}</p>
                        <div class="mt-4 flex justify-between items-center pt-4 border-t border-slate-50 text-[8px] font-black text-slate-300 uppercase tracking-widest">
                            <span>Paroisse La Croix Glorieuse</span>
                            <span>${new Date(a.created_at).toLocaleDateString()}</span>
                        </div>
                    </div>
                `).join('');
                
                if (data.length > 0) {
                    localStorage.setItem('last_annonce_date', data[0].created_at);
                }
            }
        }

        async function loadNextMesse() {
            const blocMesse = document.getElementById('next-messe');
            const details = document.getElementById('messe-details');
            const jours = ['Dimanche', 'Lundi', 'Mardi', 'Mercredi', 'Jeudi', 'Vendredi', 'Samedi'];
            const date = new Date();
            const jourNom = jours[date.getDay()];

            try {
                const { data } = await sb.from('horaires').select('*').eq('jour', jourNom);
                if (data && data.length > 0) {
                    if (data[0].evenement) {
                        details.innerHTML = `<p class="text-base font-900 leading-tight">${data[0].evenement}</p><p class="text-[11px] font-bold opacity-80 mt-1">${data[0].horaire}</p>`;
                    } else {
                        details.innerHTML = `<p class="text-base font-900 leading-tight">Messe de semaine</p><p class="text-[11px] font-bold opacity-80 mt-1">${data.map(m => m.horaire).join(', ')}</p>`;
                    }
                } else {
                    blocMesse.classList.add('hidden');
                }
            } catch (e) {
                blocMesse.classList.add('hidden');
            }
        }

        async function loadVerset() {
            const container = document.getElementById('verset-container');
            const { data } = await sb.from('versets').select('*');
            if (data && data.length > 0) {
                const v = data[Math.floor(Math.random() * data.length)];
                container.innerHTML = `
                    <p class="text-slate-400 text-[10px] font-black uppercase tracking-widest mb-2">La Parole de Vie</p>
                    <p class="text-sm italic font-semibold text-slate-700 leading-relaxed">"${v.texte}"</p>
                    <p class="text-[9px] font-black text-red-700 mt-2 uppercase text-right tracking-widest">— ${v.reference}</p>
                `;
            }
        }

        async function checkNewAnnonces() {
            const lastSeen = localStorage.getItem('last_annonce_date') || "1970-01-01T00:00:00Z";
            const { data } = await sb.from('annonces').select('created_at').order('created_at', { ascending: false }).limit(1).single();
            if (data && data.created_at > lastSeen) {
                const badge = document.getElementById('badge-annonces');
                if (badge) badge.classList.remove('hidden');
            }
        }

        // Init
        loadNextMesse();
        loadVerset();
        loadAnnonces();
        checkNewAnnonces();
    </script>
</body>
</html>
