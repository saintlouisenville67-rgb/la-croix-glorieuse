<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Groupes - La Croix Glorieuse</title>
    
    <link rel="stylesheet" href="css/style.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body class="bg-slate-50">

    <header class="gradient-header text-white p-8 rounded-b-[40px] shadow-lg">
        <h1 class="text-2xl font-800 tracking-tight mb-1">Groupes & Communautés</h1>
        <p class="text-[10px] font-black uppercase tracking-widest opacity-80">Vie de la Paroisse</p>
    </header>

    <main class="p-6 space-y-8 pb-32"> 
        <section class="card shadow-xl -mt-12 relative z-10">
            <h2 class="text-sm font-800 mb-4 text-slate-800">Trouver un groupe</h2>
            <input type="text" id="groupSearch" onkeyup="filterGroupes()" 
                placeholder="Rechercher (Scouts, Chorale...)" 
                class="w-full bg-slate-50 p-3 rounded-xl border-none text-sm font-semibold outline-none focus:ring-2 focus:ring-red-100">
        </section>

        <section class="px-2">
            <a href="https://www.croix-glorieuse.org/" target="_blank" 
                class="w-full bg-white border-2 border-slate-100 p-4 rounded-2xl flex items-center justify-between group active:scale-95 transition-all shadow-sm">
                <span class="text-[10px] font-900 text-slate-700 uppercase tracking-widest">Découvrir toutes les activités de la paroisse</span>
                <span class="text-slate-300 group-hover:text-red-700 font-bold">→</span>
            </a>
        </section>

        <section>
            <div id="groupes-list" class="grid grid-cols-1 gap-4">
                </div>
        </section>

    </main>

    <nav class="bottom-nav"></nav>

    <script src="js/config.js"></script>
    <script>
        let allGroupes = [];

        async function loadGroupes() {
            const { data, error } = await sb.from('groupes').select('*').order('nom');
            if (data) {
                allGroupes = data;
                displayGroupes(data);
            }
        }

        function displayGroupes(groupes) {
            const list = document.getElementById('groupes-list');
            list.innerHTML = groupes.map(g => `
                <div class="card animate-fade-in flex flex-col gap-4">
                    <div class="flex flex-col gap-1">
                        <div class="flex justify-between items-center">
                            <h3 class="text-sm font-800 text-slate-800">${g.nom}</h3>
                            <span class="text-[8px] font-black text-red-700 bg-red-50 px-2 py-1 rounded-full uppercase tracking-tighter">WhatsApp</span>
                        </div>
                        <p class="text-[11px] text-slate-500 leading-relaxed">
                            ${g.description && g.description.trim() !== "" ? g.description : "Rejoignez notre communauté pour échanger et rester informé des activités du groupe."}
                        </p>
                    </div>
                    
                    <a href="${g.lien_wa || '#'}" target="_blank" 
                        class="w-full gradient-header text-white py-3 rounded-xl font-black text-[9px] text-center uppercase tracking-widest shadow-md active:scale-95 transition-all">
                        Rejoindre le groupe
                    </a>
                </div>
            `).join('');
        }

        function filterGroupes() {
            const query = document.getElementById('groupSearch').value.toLowerCase();
            const filtered = allGroupes.filter(g => 
                g.nom.toLowerCase().includes(query) || 
                (g.description && g.description.toLowerCase().includes(query))
            );
            displayGroupes(filtered);
        }

        loadGroupes();
    </script>

    <style>
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in { animation: fadeIn 0.4s ease-out; }
    </style>

    <script src="js/menu.js"></script>
</body>
</html>
